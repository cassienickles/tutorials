{"title":"This Notebook is no longer up to date, a newer version exists [here](https://github.com/podaac/tutorials/blob/master/notebooks/meetings_workshops/workshop_osm_2022/Cloud_DirectDownload_AmazonRiver_Estuary_Exploration.ipynb).","markdown":{"headingText":"This Notebook is no longer up to date, a newer version exists [here](https://github.com/podaac/tutorials/blob/master/notebooks/meetings_workshops/workshop_osm_2022/Cloud_DirectDownload_AmazonRiver_Estuary_Exploration.ipynb).","containsRefs":false,"markdown":"\n## Seasonal Impacts on a Coastal Environment\n\nThis tutorial uses multiple satellite data products to explore the relationships between river height, land water equivalent thickness, sea surface salinity, and sea surface temperature in the Amazon River estuary and coastal region over several years. \nThe contents are useful for the ocean, coastal, and terrestrial hydrosphere communities, showcasing how to use on-premises and cloud datasets and services. The notebook can be executed locally, or in AWS (in *us-west-2* region where the cloud data is located).\n\n## Datasets\nThe tutorial itself will use five different datasets, which represent a combination of cloud^^- and on premise- archived datasets: \n\n   1. **TELLUS_GRAC-GRFO_MASCON_CRI_GRID_RL06_V2** \n    \n    DOI: [https://doi.org/10.5067/TEMSC-3JC62](https://doi.org/10.5067/TEMSC-3JC62) \n   \n    The Gravity Recovery And Climate Experiment Follow-On (GRACE-FO) satellite land water equivalent (LWE) thicknesses will be used to observe seasonal changes in water storage around the river. When discharge is high, the change in water storage will increase, thus highlighting a wet season. \n\n\n   2. **PRESWOT_HYDRO_GRRATS_L2_DAILY_VIRTUAL_STATION_HEIGHTS_V2** \n\n    DOI: [https://doi.org/10.5067/PSGRA-DA2V2](https://doi.org/10.5067/PSGRA-DA2V2)\n   \n    The NASA Pre-SWOT Making Earth System Data Records for Use in Research Environments (MEaSUREs) Program virtual gauges will be used as a proxy for Surface Water and Ocean Topography (SWOT) discharge until SWOT products are available. MEaSUREs contains river height products, not discharge, but river height is directly related to discharge and thus will act as a good substitute.\n\n\n   3. **SMAP_JPL_L3_SSS_CAP_MONTHLY_V5** \n    \n    DOI: [https://doi.org/10.5067/SMP50-3TMCS](https://doi.org/10.5067/SMP50-3TMCS) \n   \n    Sea surface salinity is obtained from the Soil Moisture Active Passive (SMAP) satellite (2015-2019).\n\n   \n   4. **AQUARIUS_L3_SSS-RainFlagged_SMI_DAILY_V5**\n    \n    DOI: [https://doi.org/10.5067/AQR50-3Y1CE](https://doi.org/10.5067/AQR50-3Y1CE)\n    \n    Sea surface salinity is obtained from the Aquarius/SAC-D satellite (2011-2015).\n\n   \n   5. **MODIS_AQUA_L3_SST_MID-IR_MONTHLY_9KM_NIGHTTIME_V2019.0**\n   \n    DOI: [https://doi.org/10.5067/MODAM-MO9N9](https://doi.org/10.5067/MODAM-MO9N9)\n    \n    Sea surface temperature is obtained from the Moderate Resolution Imaging Spectrometer (MODIS) instrument on board the Aqua satellite. \n\nThe tutorial will show how each of these datasets are accessed and subset for our specific location, the Amazon River estuary. Graphs and images of river height (river discharge when SWOT data is available), LWE thickness, salinity, and sea surface temperature will be created and shown side by side to enable the exploration of relationships between the data.\n\n^^During 2021 PO.DAAC is in the process of migrating its data and services to the Earthdata Cloud in Amazon Web Services (AWS). As such some data will be available for early access from or within the Earthdata Cloud, while also being available from the on-premise archive. One such Cloud Pathfinder dataset is from the GRACE and GRACE-FO missions. In this example we access GRACE/FO data from the Earthdata Cloud. As a user, during the migration period (in 2021), you will need **early access** to be able to access *cloud-based* Pathfinder datasets such as GRACE. To gain that early access, please contact podaac@podaac.jpl.nasa.gov with your request for Early Access to cloud data. Please include your Earthdata Login username. Once youâ€™ve been added to the early access list, you can then see the available collections after logging into the [PO.DAAC Cloud Earthdata Search Portal](https://search.earthdata.nasa.gov/portal/podaac-cloud/search) or run this notebook. For more information on the PO.DAAC transition to the cloud, please visit: https://podaac.jpl.nasa.gov/cloud-datasets/about\n\n## Needed Packages\n\n## Set the CMR, URS, and Harmony endpoints\n[CMR](https://cmr.earthdata.nasa.gov/search/), or the Earthdata Common Metadata Repository, is a high-performance, high-quality, continuously evolving metadata system that catalogs Earth Science data and associated service metadata records. \n[URS](https://urs.earthdata.nasa.gov/profile) is the Earthdata login system, that allows (free) download access to Earthdata data.\n[Harmony](https://harmony.earthdata.nasa.gov/) API allows you to seamlessly analyze Earth observation data from different NASA data centers.\n\n## NASA Earthdata Login Setup\n\nAn Earthdata Login account is required to access data, as well as discover restricted data, from the NASA Earthdata system. Please visit https://urs.earthdata.nasa.gov to register and manage your Earthdata Login account. This account is free to create and only takes a moment to set up.\n\nThe `setup_earthdata_login_auth` function will allow Python scripts to log into any Earthdata Login application programmatically. To avoid being prompted for credentials every time you run and also allow clients such as curl to log in, you can add the following to a .netrc (_netrc on Windows) file in your home directory:\n\n```shell \n    machine urs.earthdata.nasa.gov\n    login <your username>\n    password <your password>\n```\n\nMake sure that this file is only readable by the current user or you will receive an error stating \"netrc access too permissive.\"\n\n```shell\n$ chmod 0600 ~/.netrc\n```\n\n*You will be prompted for your username and password if you dont have a netrc file. Note: these imports are all in the Python 3.6+ standard library.*\n\n\n### Cloud data: GRACE Liquid Water Equivalent (LWE)\n#### Search for GRACE LWE Thickness data\nGRACE/GRACE-FO data can be obtained from the Earthdata Cloud, as described in the introduction section of this notebook.\n\n##### How to find a collection ID from the dataset landing page\nSuppose we are interested in LWE data from the dataset (DOI:10.5067/TEMSC-3JC62) described on this PO.DAAC dataset landing page: \nhttps://podaac.jpl.nasa.gov/dataset/TELLUS_GRAC-GRFO_MASCON_CRI_GRID_RL06_V2\n\nFrom the landing page, we see the dataset Short Name under the Information tab. Copy that to paste and search later. Log in to your Earthdata account at: https://search.earthdata.nasa.gov. Enter the Short Name and search. Clicking on one of the search results brings us to a list of granules. Within that URL, we can grab the concept-id, a string starting with \"C\" and ending with \"-POCLOUD\". For this dataset, it is \"C1938032626-POCLOUD\".\n\n#### Collection search in CMR\nHere we use the requests library to search in *collections* by either short name or concept-id, which returns exactly one dataset, or one \"hit\", in a JSON format.\n\n#### See collection metadata\n\n#### Granule search\nHere we use the requests library to search for *granules* in the collection. It returns 7 \"hits\", or 7 granules.\n\n#### For GRACE, when there are multiple granules, take the latest monthly granule (automate finding of most recent month?)\n\n#### Get download link\nThe download link to the .nc file is one of the RelatedURLs.\n\n#### Download the .nc file from the Earthdata cloud\nAnd display overview of contents (metadata) using ncdump. This will download the GRACE data to your local machine, or whereever you are running this notebook from.\n\n#### Open file using xarray.\n\n#### Plot a subset of the data\nUse the function `xarray.DataSet.sel` to select a subset of the data to plot. \n\n### On-premise data via OPeNDAP: River heights\nUse xarray and OPeNDAP link to see an overview of the dataset.\n\nCurrently, Pre-SWOT MEaSUREs data do not have the tools required to access them on the cloud, but methods are in the works! Here, we will obtain this dataset using OPeNDAP. OPeNDAP provides an API on the host server to access data without downloading it. OPeNDAP will also have a cloud component in the future, so this method of access can be used for both on-premise and cloud-based data in the near future and moving forward. \n\nTo find the OPeNDAP links needed to open the data (using the python package xarray), go to the specific satellite's page on PO.DAAC (ex. [Pre-SWOT MEaSUREs's site](https://podaac.jpl.nasa.gov/MEaSUREs-Pre-SWOT?sections=about%2Bdata)).\n\nClick on the dataset you want (e.g. https://podaac.jpl.nasa.gov/dataset/PRESWOT_HYDRO_GRRATS_L2_DAILY_VIRTUAL_STATION_HEIGHTS_V2) and click the \"Data Access\" tab. This will give you a link to where you can find the data in OPeNDAP (ex. https://podaac-opendap.jpl.nasa.gov/opendap/allData/preswot_hydrology/L2/rivers/daily/). \n\nFrom there, navigate to the desired NetCDF file and copy its link (e.g. for MEaSUREs, we want the Amazon estuary, so we choose the South America Amazon file: https://opendap.jpl.nasa.gov/opendap/allData/preswot_hydrology/L2/rivers/daily/South_America_Amazon1kmdaily.nc).\n\nThe [guidebook](https://podaac-tools.jpl.nasa.gov/drive/files/allData/preswot_hydrology/L2/rivers/docs/GRRATS_user_handbookV2.pdf) explains the details of the Pre-SWOT MEaSUREs data.\n\nOur desired variable is height (meters above EGM2008 geoid) for this exercise, which can be subset by distance and time. Distance represents the distance from the river mouth, in this example, the Amazon estuary. Time is between April 8, 1993 and April 20, 2019.\n\nLet's look at this example file to see how the data is organized:\n\n### On-premise data via OPeNDAP: sea surface salinity (SMAP and Aquarius) and temperature (MODIS)\n\nPre-SWOT MEaSUREs data resides in one NetCDF file for the whole time period, but the same cannot be said for SMAP, Aquarius and MODIS data. They have one file per month for their monthly datasets. SMAP has salinity data from April 2015 - present, Aquarius has salinity data from August 2011 - June 2015, and MODIS has SST data for the entire 2011-2019 time period.\n\nFirst, we create strings of OPeNDAP links in lists for each satellite product so we can obtain them and merge them into one file. The links change depending on the date, so the pattern of how the links change needs to be observed and then looped over and appended to the links file list. For example, SMAP has month and year numbers in its links, while Aquarius has start day and end day of the year in its links, so writing their strings takes different logic.\n\n#### Preview the SMAP, Aquarius, and MODIS data over region of interest\n\n#### Plotting the river distances and associated heights on the map at time t=9069 (March 16, 2018)\n\n## Time Series Comparison\n\nPlot each dataset for the time period 2011-2019.\n\nFirst, we need to average all pixels in the subset lat/lon per time for sea surface salinity across both satellites, and sea surface temperature to set up for the graphs. This could take a few minutes each. \n\n### Combined timeseries plot of river height and LWE thickness\n\nLWE thickness captures the seasonality of Pre-SWOT MEaSUREs river heights well, and so LWE thickness can be compared to all other variables as a representative of the seasonality of both measurements for the purpose of this notebook. \n\n### Combined timeseries plots of salinity and LWE thickness, followed by temperature\n\n### A close-up view of salinity and LWE thickness in 2019\n\nFor the 2019 year, measurements of LWE thickness and SSS follow expected patterns. When lwe thickness is at its peak, indicating a large amount of water in the river from the wet season between March and June, SSS is at its lowest. The high volume of water from the river output into the estuary decreases the salinity. Points on the graph do not line up exactly month by month because GRACE-FO has specific dates for their monthly dataset whereas SMAP's monthly dataset is calculated via averaging multiple measurements over the course of the month, so it does not have a specific day, but only a specific month. \n\n## More Visualizing Data on the Map\n\n### Timelapses\n\nTo visualize GRACE and SMAP data, timelapses have been created for the year 2019:\n\n### SMAP Timelapse\n\n## Future Modifications\n\nThis is not a static notebook and can be altered as more cloud data and services become available.\n\nIn the future, when the upcoming Surface Water and Ocean Topography (SWOT) satellite has been launched, data products for discharge can be added to analyze the impact discharge specifically has on the coastal environment. \n\nAll these datasets will be able to be accessed through the cloud in the future; OPeNDAP will have a cloud interface. Check back on [PO.DAAC's Cloud Data](https://podaac.jpl.nasa.gov/cloud-datasets/about) page for updates.\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":true,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":false,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"jupyter"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"wrap","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","filters":["../include-files.lua","quarto"],"toc":true,"output-file":"AmazonRiver_Estuary_Exploration.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.1.251","theme":{"light":["cosmo","theme.scss"],"dark":["cosmo","theme-dark.scss"]},"code-copy":true},"extensions":{"book":{"multiFile":true}}}}}