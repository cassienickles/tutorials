{"title":"Mississippi River Heights Exploration:","markdown":{"headingText":"Mississippi River Heights Exploration:","containsRefs":false,"markdown":"\n> From the PO.DAAC Cookbook, to access the GitHub version of the notebook, follow [this link](https://github.com/podaac/tutorials/blob/master/notebooks/meetings_workshops/swot_ea_hackweek_2022/River_Heights_in_the_Cloud.ipynb).*\n\n## Working with In Situ Measurements and Satellite Hydrology Data in the Cloud\n\n### Learning Objectives\n - Access data from the cloud (Pre-SWOT MEaSUREs river heights) and utilize in tandem with locally hosted dataset (USGS gauges)\n - Search for products using Earthdata Search GUI\n - Access datasets using xarray and visualize\n\nThis tutorial explores the relationships between satellite and in situ river heights in the Mississippi River using the data sets listed below. The notebook is designed to be executed in Amazon Web Services (AWS) (in *us-west-2* region where the cloud data is located).\n\n## Datasets\nThe tutorial itself will use two different datasets: \n\n1\\. **PRESWOT_HYDRO_GRRATS_L2_DAILY_VIRTUAL_STATION_HEIGHTS_V2** \n\n>DOI: [https://doi.org/10.5067/PSGRA-DA2V2](https://doi.org/10.5067/PSGRA-DA2V2)\n   \n    The NASA Pre-SWOT Making Earth System Data Records for Use in Research Environments (MEaSUREs) Program virtual river height gauges from various altimeter satellites. \n\n   \n2\\. **USGS Water Data for the Nations River Gauges**\n   \n>URL: [https://dashboard.waterdata.usgs.gov/app/nwd/?region=lower48&aoi=default](https://dashboard.waterdata.usgs.gov/app/nwd/?region=lower48&aoi=default)\n    \n    River heights are obtained from the United States Geologic Survey (USGS) National Water Dashboard.\n\n\n## Needed Packages\n\n## Get Temporary AWS Credentials for Access\n\nS3 is an 'object store' hosted in AWS for cloud processing. Direct S3 access is achieved by passing NASA supplied temporary credentials to AWS so we can interact with S3 objects from applicable Earthdata Cloud buckets. Note, these temporary credentials are valid for only 1 hour. A netrc file is required to aquire these credentials. Use the [NASA Earthdata Authentication](https://github.com/NASA-Openscapes/2021-Cloud-Hackathon/blob/main/tutorials/04_NASA_Earthdata_Authentication.ipynb) to create a netrc file in your home directory. (Note: A NASA Earthdata Login is required to access data from the NASA Earthdata system. Please visit https://urs.earthdata.nasa.gov to register and manage your Earthdata Login account. This account is free to create and only takes a moment to set up.) \n\nThe following crediential is for PODAAC, but other credentials are needed to access data from other NASA DAACs.\n\nCreate a function to make a request to an endpoint for temporary credentials.\n\n#### Set up an `s3fs` session for Direct Access\n`s3fs` sessions are used for authenticated access to s3 bucket and allows for typical file-system style operations. Below we create session by passing in the temporary credentials we recieved from our temporary credentials endpoint.\n\n## Pre-SWOT MEaSUREs River Heights\nThe shortname for MEaSUREs is 'PRESWOT_HYDRO_GRRATS_L2_DAILY_VIRTUAL_STATION_HEIGHTS_V2' with the concept ID: C2036882359-POCLOUD. The [guidebook](https://podaac-tools.jpl.nasa.gov/drive/files/allData/preswot_hydrology/L2/rivers/docs/GRRATS_user_handbookV2.pdf) explains the details of the Pre-SWOT MEaSUREs data.\n\nOur desired MEaSUREs variable is river height (meters above EGM2008 geoid) for this exercise, which can be subset by distance and time. Distance represents the distance from the river mouth, in this example, the Mississippi River. Time is between April 8, 1993 and April 20, 2019.\n\nFor this dataset, we found the cloud-enabled data directly using the Earthdata Search [(see the Earthdata Search for downloading data tutorial)](https://github.com/podaac/tutorials/blob/master/notebooks/batch_download_podaac_data.md) by searching directly for the concept ID, and locating the granule needed, G2105959746-POCLOUD, that will show us the Mississippi river. \n\n![image.png](attachment:59a10259-e43c-4225-b2c4-7138f89ae7d6.png)\n\nThe s3 link for this granule can be found in it's meta data by viewing the details of the granule from the button with three vertical dots in the corner. The s3 link is under 'relatedURLs', or it can be found by going through the download process and instead of downloading, clicking the tab entitled \"AWS S3 Access.\"\n\n![image.png](attachment:6e689a2b-c665-43ca-a05b-2adf8901ae0c.png)\n\nLet's access the netCDF file from an s3 bucket and look at the data structure.\n\n#### Plot a subset of the data\nPlotting the river distances and associated heights on the map at time t=9069 (March 16, 2018) using `plt`.\n\n## USGS Gauge River Heights\n\n\nIn situ measurements on the Mississippi River can be obtained from the United States Geologic Survey (USGS) [National Water Dashboard](https://dashboard.waterdata.usgs.gov/app/nwd/?region=lower48&aoi=default).\n\nHere, we zoom into one of the streamgauges toward the outlet of the Mississippi River, Monitoring location 07374525: Mississippi River at Belle Chasse, LA highlighted in green.\n![image.png](attachment:9d3133b3-6d1e-48aa-b8e1-a16d510df1c2.png)\n\nIf the point is selected, data can be obtained for the particular location. This gauge is located at lon, lat: (-89.977847, 29.85715084) and we can obtain gauge height for the time period October 2008 - 2021. \n\nOnce the text file is downloaded for the gauge heights, and the headers removed, it can be uploaded to the cloud as a dataframe to work alongside the MEaSUREs data. Click the `upload files` button in the top left corner to do so.\n\n\n#### Plot the data\n\n#### Find the same location in the MEaSUREs Dataset using lat/lon\n\nThe closest location in the MEaSUREs dataset to the gauge (-89.977847, 29.85715084) is at index 106 where lon, lat is (-89.976628, 29.855369). We'll use this for comparison.\n\n### Combined timeseries plot of river heights from each source\n\n### Looks like the datums need fixing!\n\nThe USGS gauge datum is 6.58 feet below NAVD88 GEOID12B EPOCH 2010, while the MEaSUREs datum is height above the WGS84 Earth Gravitational Model (EGM 08) geoid, causing this discrepancy. \n\n## Use Case: Validation\n\nTo validate the MEaSUREs dataset, the authors of the dataset actually compare relative heights between gauges, as opposed to absolute heights, in order to avoid the influence of datum errors and the lack of correspondence between satellite ground tracks and gauge locations. They calculate relative heights by removing the long-term mean of difference between the sample pairs of virtual station heights and the stage measured by the stream gauges. We'll repeat this method below for completeness and calculate the Nash-Sutcliffe Efficiency (NSE) value. \n\n#### Nash Sutcliffe Efficiency\n\nNSE for Oct 2013 - Sept 2014 water year:\n\n### Possible Explanations for discrepancies\n\n - Multiple satellites, different return periods\n - Data interpolation\n - Satellite tracks instead of swaths like SWOT will have, spatial interpolation\n - Radar altimeter performance varies, was not designed to measure rivers\n\nMEaSUREs is comprised of the Global River Radar Altimeter Time Series (GRRATS) 1km/daily interpolation river heights from ERS1, ERS2, TOPEX/Poseidon, OSTM/Jason-2, Envisat, and Jason-3 that are interpolated and processed to create continuous heights for the study over the temporal range of the altimeters used. Each satellite has differing return periods (ie. Jason has a 10-day revist, Envisat 35 days) so to fill the data gaps, perhaps much needed to be interpolated and caused misalignment. In addition, the satellite tracks of these altimeter satellites do not capture entire river reaches with wide swath tracks like the Surface Water and Ocean Topography (SWOT) mission will do in the future. Thus locations observed among satellites may be different and data interpolated spatially, increasing errors. Also, radar altimeter performance varies dramatically across rivers and across Virtual Stations, as the creators of the dataset mention in the [guidebook](https://podaac-tools.jpl.nasa.gov/drive/files/allData/preswot_hydrology/L2/rivers/docs/GRRATS_user_handbookV2.pdf).\n\nIn addition, the authors note that the Mississippi NSE values ranged from -0.22 to 0.96\nwith an average of 0.43 when evaluating the dataset, so it looks like we unintentionally honed into one of the stations with the worst statistics on the Mississippi River.\n\n## Conclusions\n - Regardless, the workflow works!\n - Data from the cloud (Pre-SWOT MEaSUREs river heights) is used in tandem with in situ measurements (USGS gauges)\n - Time and download space saved\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":true,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":false,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"jupyter"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"wrap","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","filters":["../../../include-files.lua","quarto"],"toc":true,"output-file":"River_Heights_in_the_Cloud.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.2.335","theme":{"light":"cosmo","dark":"darkly"},"code-copy":true},"extensions":{"book":{"multiFile":true}}}}}