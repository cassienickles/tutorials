{"title":"Amazon Estuary Exploration:","markdown":{"headingText":"Amazon Estuary Exploration:","containsRefs":false,"markdown":"\n## In AWS Cloud Version\n\nThis tutorial is one of two jupyter notebook versions of the same use case exploring multiple satellite data products over the Amazon Estuary. In this version, we use data products directly **in the Amazon Web Services (AWS) Cloud**. \n\n### Learning Objectives\n - Compare cloud access methods (in tandem with notebook \"Amazon Estuary Exploration: Cloud Direct Download Version\")\n - Search for data products using Earthdata Search GUI\n - Access datasets using direct s3 access in cloud, xarray and visualize using hvplot or plot tools\n\nThis tutorial explores the relationships between river height, land water equivalent thickness, sea surface salinity, and sea surface temperature in the Amazon River estuary and coastal region from multiple datasets listed below. The contents are useful for the ocean, coastal, and terrestrial hydrosphere communities, showcasing how to use cloud datasets and services. The notebook is designed to be executed in Amazon Web Services (AWS) (in *us-west-2* region where the cloud data is located).\n\n## Cloud Datasets\nThe tutorial itself will use four different datasets: \n\n1\\. **TELLUS_GRAC-GRFO_MASCON_CRI_GRID_RL06_V2** \n    \n>DOI: [https://doi.org/10.5067/TEMSC-3JC62](https://doi.org/10.5067/TEMSC-3JC62) \n   \n    The Gravity Recovery And Climate Experiment Follow-On (GRACE-FO) satellite land water equivalent (LWE) thicknesses will be used to observe seasonal changes in water storage around the river. When discharge is high, the change in water storage will increase, thus highlighting a wet season. \n\n\n2\\. **PRESWOT_HYDRO_GRRATS_L2_DAILY_VIRTUAL_STATION_HEIGHTS_V2** \n\n>DOI: [https://doi.org/10.5067/PSGRA-DA2V2](https://doi.org/10.5067/PSGRA-DA2V2)\n   \n    The NASA Pre-SWOT Making Earth System Data Records for Use in Research Environments (MEaSUREs) Program virtual gauges will be used as a proxy for Surface Water and Ocean Topography (SWOT) discharge until SWOT products are available. MEaSUREs contains river height products, not discharge, but river height is directly related to discharge and thus will act as a good substitute.\n\n\n3\\. **OISSS_L4_multimission_7day_v1** \n    \n>DOI: [https://doi.org/10.5067/SMP10-4U7CS](https://doi.org/10.5067/SMP10-4U7CS) \n   \n    Optimally Interpolated Sea surface salinity (OISSS) is a level 4 product that combines the records from Aquarius (Sept 2011-June 2015), the Soil Moisture Active Passive (SMAP) satellite (April 2015-present), and ESAs Soil Moisture Ocean Salinity (SMOS) data to fill in data gaps.\n\n   \n4\\. **MODIS_AQUA_L3_SST_MID-IR_MONTHLY_9KM_NIGHTTIME_V2019.0**\n   \n>DOI: [https://doi.org/10.5067/MODAM-MO9N9](https://doi.org/10.5067/MODAM-MO9N9)\n    \n    Sea surface temperature is obtained from the Moderate Resolution Imaging Spectrometer (MODIS) instrument on board the Aqua satellite. \n\nMore details on available collections are on the [PO.DAAC Cloud Earthdata Search Portal](https://search.earthdata.nasa.gov/portal/podaac-cloud/search). For more information on the PO.DAAC transition to the cloud, please visit: https://podaac.jpl.nasa.gov/cloud-datasets/about\n\n\n\n## Needed Packages\n\n## Get Temporary AWS Credentials for Access\n\nS3 is an 'object store' hosted in AWS for cloud processing. Direct S3 access is achieved by passing NASA supplied temporary credentials to AWS so we can interact with S3 objects from applicable Earthdata Cloud buckets. Note, these temporary credentials are valid for only 1 hour. A netrc file is required to aquire these credentials. Use the [NASA Earthdata Authentication](https://github.com/NASA-Openscapes/2021-Cloud-Hackathon/blob/main/tutorials/04_NASA_Earthdata_Authentication.ipynb) to create a netrc file in your home directory. (Note: A NASA Earthdata Login is required to access data from the NASA Earthdata system. Please visit https://urs.earthdata.nasa.gov to register and manage your Earthdata Login account. This account is free to create and only takes a moment to set up.) \n\nThe following crediential is for PODAAC, but other credentials are needed to access data from other NASA DAACs.\n\nCreate a function to make a request to an endpoint for temporary credentials.\n\n#### Set up an `s3fs` session for Direct Access\n`s3fs` sessions are used for authenticated access to s3 bucket and allows for typical file-system style operations. Below we create session by passing in the temporary credentials we recieved from our temporary credentials endpoint.\n\n## Liquid Water Equivalent (LWE) Thickness (GRACE & GRACE-FO)\n#### Search for GRACE LWE Thickness data\n\nSuppose we are interested in LWE data from the dataset (DOI:10.5067/TEMSC-3JC62) described on this PO.DAAC dataset landing page: \nhttps://podaac.jpl.nasa.gov/dataset/TELLUS_GRAC-GRFO_MASCON_CRI_GRID_RL06_V2 From the landing page, we see the dataset Short Name under the Information tab. Copy that to paste and search later.\n\nLog in to your Earthdata account at: https://search.earthdata.nasa.gov. Enter the Short Name and search. Clicking on one of the search results brings us to a list of granules. Within that URL, we can grab the concept-id, a string starting with \"C\" and ending with \"-POCLOUD\". For this dataset, it is \"C1938032626-POCLOUD\" and it only has one granule. The s3 link for this granule can be found in it's meta data by viewing the details of the granule from the button with three vertical dots in the corner. The s3 link is under 'relatedURLs'.\n\n#### Open the .nc file in the s3 bucket and load it into an `xarray` dataset\n\n#### Plot a subset of the data\nUse the function `xarray.DataSet.sel` to select a subset of the data to plot with `hvplot`. \n\n## River heights (Pre-SWOT MEaSUREs)\nThe shortname for MEaSUREs is 'PRESWOT_HYDRO_GRRATS_L2_DAILY_VIRTUAL_STATION_HEIGHTS_V2' with the concept ID: C2036882359-POCLOUD. The [guidebook](https://podaac-tools.jpl.nasa.gov/drive/files/allData/preswot_hydrology/L2/rivers/docs/GRRATS_user_handbookV2.pdf) explains the details of the Pre-SWOT MEaSUREs data.\n\nOur desired variable is height (meters above EGM2008 geoid) for this exercise, which can be subset by distance and time. Distance represents the distance from the river mouth, in this example, the Amazon estuary. Time is between April 8, 1993 and April 20, 2019.\n\nFor this dataset, we found the cloud-enabled data directly using the Earthdata Search [(see the Earthdata Search for downloading data tutorial)](https://github.com/podaac/tutorials/blob/master/notebooks/batch_download_podaac_data.md) by searching directly for the concept ID, and locating the granule needed, G2105958903-POCLOUD, that will show us the Amazon river. The s3 link for this granule can be found in it's meta data by viewing the details of the granule from the button with three vertical dots in the corner. The s3 link is under 'relatedURLs'.\n\n![image.png](attachment:5f58d586-87fb-4aea-ab19-b9c030484f4b.png)\n\nLet's again access the netCDF file from an s3 bucket and look at the data structure.\n\n#### Plot a subset of the data\nPlotting the river distances and associated heights on the map at time t=9069 (March 16, 2018) using `plt`.\n\n## Sea Surface Salinity (Multi-mission: SMAP, Aquarius, SMOS)\n\nThe shortname for this dataset is 'OISSS_L4_multimission_7day_v1' with the concept ID: C2095055342-POCLOUD. This dataset contains hundreds of granules, so it would be impractical to search and copy all of the URLs in Earthdata Search. Using the shortname, we can access all the files at once in the cloud (1.1 GB data), but here we are just going to look specifcally at 2 years of data: the drought years of 2015-16 (193 MB).\n\nOpen the netCDF files using the `s3fs` package and then load them all into a concatenated `xarray datast`\n\n#### Plot a subset of the data\nUse the function `xarray.DataSet.sel` to select a subset of the data at the outlet of the Amazon to plot at time t=0 (August 28, 2011) with `hvplot`. \n\n## Sea Surface Temperature (MODIS)\n\nMODIS has SST data that coincides with the period used for SSS, 2011-present (943 MB), and has the short name: \"MODIS_AQUA_L3_SST_MID-IR_MONTHLY_9KM_NIGHTTIME_V2019.0\". Let's access this in the same method as before.\n\nGet a list of files so we can open them all at once, creating an `xarray dataset` using the `open_mfdataset()` function to \"read in\" all of the netCDF4 files in one call. MODIS does not have a built-in time variable like SSS, but it is subset by latitude and longitude coordinates. We need to combine the files using the nested format with a created 'time' dimension.\n\nMODIS did not come with a time variable, so it needs to be extracted from the file names and added in the file preprocessing so files can be successfully concatenated.\n\n#### Plot a subset of the data\nUse the function `xarray.DataSet.sel` to select a subset of the data at the outlet of the Amazon to plot with `hvplot`. \n\n## Time Series Comparison\n\nPlot each dataset for the time period 2011-2019.\n\nFirst, we need to average all pixels in the subset lat/lon per time for sea surface salinity and sea surface temperature to set up for the graphs.\n\n### Combined timeseries plot of river height and LWE thickness\n\nBoth datasets are mapped for the outlet of the Amazon River into the estuary.\n\nLWE thickness captures the seasonality of Pre-SWOT MEaSUREs river heights well, and so LWE thickness can be compared to all other variables as a representative of the seasonality of both measurements for the purpose of this notebook. \n\n### Combined timeseries plots of salinity and LWE thickness, followed by temperature\n\nMeasurements of LWE thickness and SSS follow expected patterns. When lwe thickness is at its lowest, indicating less water is flowing through during the drought, salinity is at its highest. Without high volume of water pouring into the estuary, salinity increases. We can see that temperature is shifted a bit in time from river height as well at the outlet, a relationship that could be further explored.\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":true,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":false,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"jupyter"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"wrap","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","filters":["../../../include-files.lua","quarto"],"toc":true,"output-file":"CloudAWS_AmazonRiver_Estuary_Exploration.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.1.251","theme":{"light":"cosmo","dark":"darkly"},"code-copy":true},"extensions":{"book":{"multiFile":true}}}}}